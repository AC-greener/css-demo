<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
  CSP内容安全策略
  <meta http-equiv="Content-Secturity-Policy" content="script-src 'selft' https://whiteList.com">
  Content-Security-Policy: script-src 'self' 'https://whiteList.com' 
  hello

  <script>
  var Observer = function() {
    let subs = {}
    return {
      getSubs() {
        return subs
      },
      on(type, callback) {
        if(!subs[type]) {
          subs[type] = [callback]
        } else {
          subs[type].push(callback)
        }
      },
      emit(type, args) {
        if(subs[type]) {
          subs[type].forEach(fn => {
            fn.call(this, args)
          })
        } else {
          throw new Error(`event ${type} not exist!`)
        }
      },
      remove(type) {
        if(subs[type]) {
          delete subs[type]
        }
      },
      once(type, callback) {
        this.on(type, (args) => {
          callback(args)
          this.remove(type)
        })
      }
    }
  }()
 
  Observer.once('xx', (args) => {console.log('xx', args)})
  Observer.getSubs()
  Observer.emit('xx', 'hello')
  Observer.emit('xx', 'hello')
  </script>
  <!-- <script src="./js必会的代码.js"></script> -->
</body>
</html>